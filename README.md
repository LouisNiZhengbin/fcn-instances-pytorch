# Instance Segmentation
An in-progess repository by Allie Del Giorno (Carnegie Mellon University) investigating instance segmentation approaches

## Installation
Recommended: install a virtual environment, and activate the environment.
Install the packages from the requirements file (a superset of the true requirements, so feel free to install selectively and attempt to rerun if you'd like; the requirements.txt file is generated by running pip freeze > requirements.txt while my virtualenv is active.).  Example:

`activate <virtualenv path>`
`pip install -r requirements.txt`

Try running a sample experiment:
`python scripts/train_instances_filtered.py synthetic -g 0 -c 0`

All packages I have are listed in the requirements.txt file; not all are actually required, so feel free to be more conservative with your own virtual environment.

## Scripts (Examples)
Each of the scripts requires an argument for the GPU number to run on.  If you'd like to run on CPU, set -g to -1.

### Help (overview of command-line parameters)
python scripts/train_instance_filtered.py synthetic --help
python scripts/train_instance_filtered.py cityscapes --help
python scripts/train_instance_filtered.py voc --help

### Synthetic commands -- examples:
`python scripts/train_instances_filtered.py synthetic -g 0 -c 0`

`python scripts/train_instances_filtered.py synthetic -g 0 -c square2 --portrait`

### Run on PASCAL VOC:
`python scripts/train_instances_filtered.py voc -g 0 -c 0`

### Run on Cityscapes:
`python scripts/train_instances_filtered.py voc -g 0 -c 0`

`python scripts/train_instances_filtered.py cityscapes -g 2 -c car_instance --sampler car_2_4 --interval_validate 4000 --lr 1e-6 --export_activations False --write_instance_metrics False --ordering bigsmall --n_instances_per_class 4 --dataset_instance_cap 'match_model'`

## Analysis scripts
Log directories refer to parent directories that contain <logdir>/model_best.pth and <logdir>/<tensorboard_log>

### Location heatmaps
`python scripts/analysis/script_for_location_heatmaps.py --logdir <path_to_log_directory>`

### Dataset
(Currently exports stats for Cityscapes, but can easily be changed for other datasets)
`python scripts/analysis/analyze_dataset.py -g 0`

### Misc
python scripts/analysis/script_in_depth_evaluation.py --logdir <logdir>

## Pointers to the interesting parts of the code
**Matching loss**: [torchfcn/losses.py](torchfcn/losses.py)

**Network architecture**: [torchfcn/models/fcn8s_instance.py](torchfcn/models/fcn8s_instance.py)

## TODOs for GitHub users
- Make directory changes and other per-machine configurations easy
- Rename torchfcn directory (no longer an apt name, but delaying the refactor until the code is stable)
- More tests -- dataset loading
- Basic examples (one synthetic; one saved-model-with-real-image)

## Credit
This project was originally built on top of [pytorch-fcn](https://github.com/wkentaro/pytorch-fcn "pytorch-fcn"), but now you may not see much resemblance...
